---
title: "Publicaci√≥n de datos abiertos de Previaje"
description: "Publicaci√≥n de los primeros datos que surgen de la carga de viajes y comprobantes y del gasto del cr√©dito de las primeras tres ediciones del programa."
output:
  distill::distill_article:
    self_contained: true
    toc: true
    toc_floate: true
draft: false    
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r}
library(herramientas)
library(tidyverse)
library(lubridate)
library(comunicacion)
library(ggtext)
library(glue)
library(directlabels)
```

# Presentaci√≥n

El programa de incentivos a la preventa de servicios tur√≠sticos nacionales "Previaje" es una pol√≠tica 
iniciada en 2020 por el Ministerio de Turismo y Deportes, que cuenta hasta la fecha con tres ediciones
completadas y se encuentra en etapa de preparaci√≥n una cuarta edici√≥n. 

El programa consiste en el reconocimiento de un cr√©dito, por parte del Estado Nacional, de un 50%
de las compras de servicios tur√≠sticos en destinos nacionales.[^link_previaje]

[^link_previaje]: Para m√°s detalles del programa visitar previaje.gob.ar. Las ediciones anteriores pueden consultarse en previaje2020.gob.ar y previaje2021.gob.ar

A lo largo de las distintas ediciones, los objetivos del programa fueron evolucionando. El impacto de la pandemia, especialmente severo en el sector tur√≠stico, requiri√≥ de la primera edici√≥n del programa para garantizar la temporada alta de 2021, per√≠odo en el cual la incertidumbre sobre la evoluci√≥n de la pandemia a√∫n requer√≠a limitaciones a la circulaci√≥n de personas. La reactivaci√≥n del sector coincidi√≥ con la segunda edici√≥n, que transcurri√≥ entre los √∫ltimos meses de 2021 y durante 2022. Por √∫ltimo, Previaje 3 se lanz√≥ entre septiembre y noviembre de 2022, con el objetivo de suavizar la estacionalidad de la demanda, caracter√≠stica saliente de esta actividad. En adelante, el objetivo de elevar la actividad tur√≠stica en temporada baja marcar√° futuras ediciones.

El proceso de carga de los comprobantes para obtener el cr√©dito correspondiente incluy√≥ la carga de un conjunto de datos de las personas beneficiarias -como la ubicaci√≥n de residencia, edad, g√©nero- y sus viajes -las fechas de inicio y finalizaci√≥n, el origen y el o los destinos, caracter√≠sticas del grupo de viaje, entre otras- y de los prestadores -la actividad a la que pertenecen, ubicaci√≥n, etc.-.

Por otro lado, cada gasto del cr√©dito otorgado es registrado por las procesadoras de medios de pago a la que pertenecen las tarjetas de cr√©dito asociadas a las cuentas de acreditaci√≥n del beneficio. 

A partir de estos datos, la Direcci√≥n Nacional de Mercados y Estad√≠stica (DNMyE), pone a disposici√≥n un conjunto de recursos con algunas de las variables m√°s relevantes que surgen del proceso de carga y del gasto del cr√©dito. Se trata, en todos los casos, de datos agregados y totalmente an√≥nimos, de manera que no sea posible identificar a las personas beneficiarias ni sus viajes. En este sentido, fueron eliminados aquellos registros que agrupaban menos de 3 observaciones.

En esta oportunidad, se presentan 5 recursos:

<aside>

***Datos Abiertos de Previaje***

üìä [Recursos](https://datos.yvera.gob.ar/dataset/previaje)\

</aside>

1. Cantidad de comprobantes y monto total por fecha de carga y rama de actividad del prestador (seg√∫n el Clasificador de Actividades Econ√≥micas -CLAE- de AFIP a 6 d√≠gitos)
2. Cantidad de prestadores y establecimientos inscriptos por rama de actividad (CLAE a 6 d√≠gitos)
3. Cantidad de viajes y viajeros por mes de inicio, provincia de origen y provincia de destino
4. Cantidad de personas beneficiarias por provincia de residencia, grupos de edad y g√©nero 
5. Cantidad de operaciones y monto total por fecha, perteneciente al consumo del cr√©dito

Los distintos recursos ya publicados por la DNMyE, relativos al [turismo interno](https://datos.yvera.gob.ar/dataset?groups=turismo-interno), la [ocupaci√≥n hotelera](https://datos.yvera.gob.ar/dataset?groups=sector-hotelero), as√≠ como el resto de los recursos del [Sistema de Informaci√≥n Tur√≠stica de la Argentina (SINTA)](https://www.yvera.tur.ar/sinta/), servir√°n para poner en contexto la contribuci√≥n del programa.

<aside>

***Datos abiertos de turismo en Argentina***

üìä [EVyTH](https://datos.yvera.gob.ar/dataset/encuesta-viajes-turismo-hogares-evyth)\
üìä [EOH](https://datos.yvera.gob.ar/dataset/encuesta-ocupacion-hotelera-parahotelera-eoh)\
üìä [Portal datos abiertos](https://datos.yvera.gob.ar)

</aside>


# Algunas aplicaciones de los datos

```{r}
comprobantes <- read_csv("/srv/DataDNMYE/previaje/data_abierta/comprobantes_fecha.csv")
```
```{r}
r_daily_perc <- function(fecha, r_monthly_perc) {
  # Calculate number of days in the month
  n_days <- days_in_month(fecha)
  # Calculate daily rate 
  ((1 + (r_monthly_perc))^(1/n_days) - 1)
}
```

```{r} 
comprobantes_edicion <-  comprobantes %>% 
  group_by(edicion)%>% 
  summarise(comprobantes = sum(comprobantes),
            monto = sum(monto))
# Cargo IPC
ipc_hyr <- read_csv("/srv/DataDNMYE/economia2/ipc.csv") %>% 
  filter(rubro == "Restaurantes y hoteles") 

ipc_hyr_diario <- ipc_hyr %>% 
  mutate(tasa_mensual = indice/lag(indice,1)-1,
         tasa_mensual_shift = lead(tasa_mensual)) %>% 
  complete(fecha = seq.Date(from = min(ipc_hyr$fecha), to = max(ipc_hyr$fecha)+months(1), by="1 day"),fill = list(indice = NA)) %>% 
  filter(fecha >= "2017-02-01") %>% 
  mutate(#tasa_mensual = zoo::na.locf(tasa_mensual),
         tasa_mensual_shift = zoo::na.locf(tasa_mensual_shift)) %>% 
  mutate(indice = zoo::na.locf(indice)) %>%
  mutate(rubro = zoo::na.locf(rubro)) %>%
  mutate(tasa_diaria = r_daily_perc(fecha,tasa_mensual_shift),
         indice_diario = indice)

for (i in 2:nrow(ipc_hyr_diario)){
  ipc_hyr_diario$indice_diario[i] <- ipc_hyr_diario$indice_diario[i-1]*(1+ipc_hyr_diario$tasa_diaria[i-1])
  
}

comprobantes_real <- comprobantes %>% 
  left_join(ipc_hyr_diario %>% select(fecha,indice_diario),by=c("fecha_carga"="fecha")) %>% 
  mutate(indice_100_ultimo = indice_diario/last(indice_diario),
         monto_real = monto/indice_100_ultimo) %>% 
  group_by(edicion) %>% 
  summarise(monto = sum(monto),
            monto_real=sum(monto_real),
            comprobantes = sum(comprobantes))
```

El primer recurso, que cuenta la cantidad de comprobantes y el monto total por fecha de carga,
permite dimensionar la magnitud de las tres ediciones. En la primera edici√≥n se cargaron `r format(round(comprobantes_edicion[comprobantes_edicion$edicion == "previaje 1","comprobantes"]/1),big.mark=".")` comprobantes por un total de 
\$`r format(round(comprobantes_edicion[comprobantes_edicion$edicion == "previaje 1","monto"]/1e+6,1),decimal.mark=",",big.mark=".")` millones. La segunda edici√≥n fue la de mayor 
tama√±o, con un total de `r format(round(comprobantes_edicion[comprobantes_edicion$edicion == "previaje 2","comprobantes"]/1),big.mark=".")` comprobantes por  
\$`r format(round(comprobantes_edicion[comprobantes_edicion$edicion == "previaje 2","monto"]/1e+6,1),decimal.mark=",",big.mark=".")` millones. La tercera edici√≥n, concentrada en 
viajes de octubre y noviembre, tuvo cargas de `r format(round(comprobantes_edicion[comprobantes_edicion$edicion == "previaje 3","comprobantes"]/1),big.mark=".")` comprobantes y una facturaci√≥n de  \$`r format(round(comprobantes_edicion[comprobantes_edicion$edicion == "previaje 3","monto"]/1e+6,1),decimal.mark=",",big.mark=".")` millones. En t√©rminos reales, el monto de los comprobantes de la segunda edici√≥n fue 6 veces superior a la primera y 7 veces mayor que 
la tercera.[^gasto_real]

[^gasto_real]: Se calcul√≥ el gasto diario deflactado por IPC Nacional, divisi√≥n Restaurantes y Hoteles, distribuyendo la variaci√≥n mensual en cada d√≠a del mes.

```{r}
comprobantes_graf <- comprobantes %>% 
  mutate(monto_millones =monto/1e+6) %>% 
  group_by(fecha_carga,edicion) %>% 
  summarise(comprobantes = sum(comprobantes),
            monto = sum(monto),
            monto_millones = sum(monto_millones)) %>% 
  pivot_longer(cols = c("comprobantes","monto","monto_millones"),values_to = "val",names_to = "var") %>% 
  ungroup() %>% 
  filter(var != "monto")
comprobantes_graf %>% 
  ggplot()+
  geom_area(aes(x=fecha_carga,y=val,fill=edicion))+
  scale_y_continuous(labels=scales::number_format(big.mark = "."))+
  scale_x_date(date_breaks  = "3 months",date_labels = "%b %y")+
  scale_fill_manual(name="",values = c(dnmye_colores(7),dnmye_colores(2),dnmye_colores(1)),
                    labels = c("Previaje 2020","Previaje 2021","Previaje 2022"))+
  facet_wrap(~ var,ncol = 1,scales = "free_y",labeller = as_labeller(c(comprobantes="Comprobantes",monto_millones="Monto (millones de pesos)")))+
  theme_minimal()+
  theme(legend.position="bottom",
        strip.text.x = element_markdown(face = "bold",family = "Encode"))+
  labs(x="",y="",
       title = "Comprobantes y monto total por fecha de carga")
```

```{r}
prestadores <- read_csv("/srv/DataDNMYE/previaje/data_abierta/prestadores_clae.csv")
prestadores_edicion <- prestadores %>% 
  group_by(edicion) %>% 
  summarise(prestadores = sum(prestadores),
            establecimientos = sum(as.numeric(establecimientos),na.rm=T))
prestadores_clae2_pv2 <- prestadores %>% 
  filter(edicion == "previaje 2") %>% 
  group_by(clae2_desc) %>% 
  summarise(prestadores = sum(prestadores),
            establecimientos = sum(as.numeric(establecimientos))) %>% 
  ungroup() %>% 
  arrange(-establecimientos) %>% 
  mutate(part_establecimientos = establecimientos/sum(establecimientos),
         part_acum_establecimientos = cumsum(part_establecimientos))

```

La participaci√≥n de los prestadores en el programa fue elevada desde la primera edici√≥n. 
En ella, se inscribieron `r format(as.numeric(prestadores_edicion[prestadores_edicion$edicion == "previaje 1","prestadores"]),big.mark=".")` prestadores, mientras que en la segunda lo hicieron `r format(as.numeric(prestadores_edicion[prestadores_edicion$edicion == "previaje 2","prestadores"]),big.mark=".")`, los que a su vez sumaron `r format(as.numeric(prestadores_edicion[prestadores_edicion$edicion == "previaje 2","establecimientos"]),big.mark=".")` establecimientos y en la tercera `r format(as.numeric(prestadores_edicion[prestadores_edicion$edicion == "previaje 3","prestadores"]),big.mark=".")` con `r format(as.numeric(prestadores_edicion[prestadores_edicion$edicion == "previaje 3","establecimientos"]),big.mark=".")` establecimientos[^establecimientos]. Observando la participaci√≥n por rama de actividad, 
en la segunda edici√≥n se inscribieron `r format(as.numeric(prestadores_clae2_pv2[prestadores_clae2_pv2$clae2_desc == "Servicios de alojamiento","establecimientos"]),big.mark=".")` establecimientos del rubro alojamiento, 
un `r format(round(100*as.numeric(prestadores_clae2_pv2[prestadores_clae2_pv2$clae2_desc == "Servicios de alojamiento","part_establecimientos"]),0),big.mark=".",decimal.mark = ",")`% del total. La actividad de agencias de viajes y servicios asociados tuvieron `r format(as.numeric(prestadores_clae2_pv2[prestadores_clae2_pv2$clae2_desc == "Agencias de viajes, servicios de reservas y actividades conexas","establecimientos"]),big.mark=".")` establecimientos inscriptos, 
un `r format(round(100*as.numeric(prestadores_clae2_pv2[prestadores_clae2_pv2$clae2_desc == "Agencias de viajes, servicios de reservas y actividades conexas","part_establecimientos"]),0),big.mark=".",decimal.mark = ",")`% del total. El restante 11% de los inscriptos se reparti√≥ entre servicios de transporte, alquiler de veh√≠culos, servicios art√≠sticos recreativos y culturales, entre otros.

[^establecimientos]: A partir de la segunda edici√≥n los prestadores pudieron cargar todos los establecimientos con los que participaban, por lo que en la primera edici√≥n no es posible obtener el dato.

```{r}
library(treemapify)
library(RColorBrewer)
nb.cols <- length(unique(prestadores$clae2_desc))
mycolors <- colorRampPalette(brewer.pal(8, "Set2"))(nb.cols)
prestadores %>%
  mutate(clae6_desc = case_when(clae6_desc == "Servicios de alojamiento en hoteles, hoster√≠as y residenciales similares, excepto por hora, que incluyen servicio de restaurante al p√∫blico" ~ "Servicios de alojamiento en hoteles, hoster√≠as y residenciales similares (c/ restaurant)",
                                clae6_desc == "Servicios de alojamiento en hoteles, hoster√≠as y residenciales similares, excepto por hora, que no incluyen servicio de restaurante al p√∫blico" ~ "Servicios de alojamiento en hoteles, hoster√≠as y residenciales similares (s/ restaurant)",
                                clae6_desc == "Servicios de hospedaje temporal n.c.p. (Incluye hospedaje en estancias, residencias para estudiantes y albergues juveniles, apartamentos tur√≠sticos, etc.)" ~ "Alojamiento (otros)",
                                clae6_desc == "Servicio de transporte automotor interurbano regular de pasajeros, E1203excepto transporte internacional (Incluye los llamados servicios de larga distancia)" ~ "Servicio de transporte automotor interurbano regular de pasajeros, excepto internac.",
                                TRUE ~ clae6_desc)) %>% 
 filter(edicion == "previaje 2") %>% 
  ggplot(.,aes(area= as.numeric(establecimientos),
               label=paste0(clae6_desc,"\n", format(as.numeric(establecimientos),big.mark=".")),
               subgroup=clae2_desc))+
   geom_treemap(aes(fill=clae2_desc))+
  scale_fill_manual(values = mycolors)+
 geom_treemap_text(colour = "black", place = "centre",
                    grow = F, reflow = T,  size = 16) +
  theme_minimal() +
  theme(
    text = element_text(), 
    legend.position = "none",
    plot.title    = element_text(size = 8, face = "bold"),
    plot.subtitle = element_text(size = 4, face = "bold"),
    plot.caption  = element_text(size = 4),
    strip.text.y  = element_text(size = 3, face = "bold"),
    axis.text.x   = element_text(size = 3),
    axis.text.y   = element_text(size = 3),
    legend.text   = element_text(size = 3),
    legend.title  = element_text(size = 4)
  ) +
  labs(title="Previaje 2: establecimientos inscriptos")
```

```{r}
beneficiarios <- read_csv("/srv/DataDNMYE/previaje/data_abierta/personas_beneficiarias.csv")
benef_edicion <- beneficiarios %>% 
  group_by(edicion) %>% 
  summarise(personas_beneficiarias = sum(personas_beneficiarias)) 
benef_edad <- beneficiarios %>% 
  group_by(edicion,tramo_edad) %>% 
  summarise(personas_beneficiarias = sum(personas_beneficiarias)) %>% 
  group_by(edicion) %>% 
  mutate(part = personas_beneficiarias/sum(personas_beneficiarias)) %>% 
  ungroup()
```

Es posible, tambi√©n, hacer un an√°lisis de las personas beneficiarias que se inscribieron en 
cada una de las ediciones del programa. Puede verse su distribuci√≥n territorial, por g√©nero y por edad. En la primera edici√≥n se inscribieron 193.911 personas, mientras que en la segunda lo hicieron 1.287.475 y en la tercera 398.009. Resulta interesante observar las diferencias de composici√≥n de las edades 
de las personas beneficiarias. Una particularidad que tuvo el programa a partir de su segunda edici√≥n es 
la ampliaci√≥n del beneficio para las personas afiliadas al PAMI, que recibieron un 70% de cr√©dito por sus 
compras de servicios tur√≠sticos. En este sentido, se evidencia un aumento de las personas beneficiarias 
de 60 a√±os y m√°s a partir de la segunda edici√≥n, pasando del 11% al 20%. La tercera edici√≥n muestra
otro aumento en la participaci√≥n de este tramo de edad, alcanzando un 28% de participaci√≥n.

```{r}
benef_edad %>% 
  mutate(edicion = str_to_title(edicion)) %>% 
  ggplot(aes(x=edicion,y=part,fill=tramo_edad))+ 
  geom_col()+
  scale_fill_dnmye(name = "")+
  scale_y_continuous(labels = scales::percent_format())+
  theme_minimal()+
  labs(title="Participaci√≥n por tramo de edad de las personas beneficiarias",
       x="",y="")
```

```{r}
viajes <- read_csv("/srv/DataDNMYE/previaje/data_abierta/viajes_origen_destino_mes.csv")
viajes_destino_edicion <- viajes %>% 
  group_by(edicion,provincia_destino) %>% 
  summarise(viajes = sum(viajes),
            viajeros = sum(viajeros)) %>% 
  group_by(edicion) %>% 
  arrange(-viajeros) %>% 
  mutate(rank = 1:n()) %>% 
  ungroup()
```

El programa tuvo, por otra parte, una amplia distribuci√≥n territorial. Provincias como
R√≠o Negro, Tierra del Fuego, Misiones o Mendoza estuvieron entre los destinos con 
mayor cantidad de viajes cargados y viajeros que los visitaron. R√≠o Negro fue la provincia con mayor cantidad 
de viajes cargados y con mayor cantidad de viajeros (96.675) en la primera edici√≥n, con Bariloche como su destino m√°s visitado.
La provincia de Buenos Aires fue especialmente elegida en la segunda edici√≥n, cuando
la Costa Atl√°ntica registr√≥ niveles de actividad muy elevados en t√©rminos hist√≥ricos (la cantidad de viajeros en esa edici√≥n lleg√≥ a 880.238). Tambi√©n fue la provincia m√°s elegida en la tercera edici√≥n,
 con 147.436 viajeros.
La Ciudad Aut√≥noma de Buenos Aires aparece como el segundo destino m√°s visitado en 
la tercera edici√≥n (104.574 viajeros), caracterizada por viajes de menor duraci√≥n.
Si se suman los viajes de las 3 ediciones, se alcanza un total de m√°s de 2 millones de viajes cargados y 
cerca de 6 millones de viajeros.[^viajeros]

[^viajeros]: A partir de la segunda edici√≥n, la carga de viajes permit√≠a cargar m√∫ltiples destinos de viajes. En esos casos, se cuenta un viaje por cada destino elegido.

```{r}
library(geoAr)
library(sf)
library(herramientas)

mapa_argentina <- read_sf("https://github.com/politicaargentina/data_warehouse/raw/master/geoAr/data_raw/provincias.geojson") %>% 
  mutate(provincia = case_when(provincia == "CABA" ~ "Ciudad Aut√≥noma de Buenos Aires",
                               TRUE ~ provincia)) 
mapa_centroides <- read_sf("centroides_prov.geojson") %>% 
  rename(provincia = name_iso) %>% 
  mutate(lat = unlist(map(geometry,2)),
         long = unlist(map(geometry,1)))

viajes_prov <- viajes %>% 
  group_by(provincia_origen,provincia_destino) %>% 
  summarise(viajes = sum(viajes)) %>% 
  mutate(provincia_origen = ifelse(provincia_origen == "Tierra del Fuego, Ant√°rtida e Islas del Atl√°ntico Sur","Tierra del Fuego",provincia_origen),
         provincia_destino = ifelse(provincia_destino == "Tierra del Fuego, Ant√°rtida e Islas del Atl√°ntico Sur","Tierra del Fuego",provincia_destino)) %>% 
  left_join(mapa_centroides,by=c("provincia_origen"="provincia")) %>% 
  mutate(lat_origen = unlist(map(geometry,2)),
         long_origen = unlist(map(geometry,1))) %>% 
  left_join(mapa_centroides,by=c("provincia_destino"="provincia")) %>% 
  mutate(lat_destino = unlist(map(geometry.y,2)),
       long_destino = unlist(map(geometry.y,1))) 

provs_viajes_origen <- viajes_prov %>% 
  group_by(provincia_origen) %>% 
  summarise(viajes_origen = sum(viajes)) %>% 
  ungroup() %>% 
  left_join(mapa_centroides, by = c("provincia_origen"="provincia"))
provs_viajes_destino <- viajes_prov %>% 
  group_by(provincia_destino) %>% 
  summarise(viajes_destino = sum(viajes)) %>% 
  ungroup() %>% 
  left_join(provs_viajes_origen, by = c("provincia_destino"="provincia_origen")) %>% 
  pivot_longer(c("viajes_origen","viajes_destino"),names_to = "var",values_to = "val") %>% 
  mutate(var = ifelse(var == "viajes_destino","DESTINO","ORIGEN"),
         across(var, factor, levels=c("ORIGEN","DESTINO"))) 


graf_previaje_od <- provs_viajes_destino %>% 
  ggplot() +
  theme_void() +
  geom_sf(data = mapa_argentina, size = 0.2, fill = "black",color="white") +
  geom_curve(data=viajes_prov %>% filter(provincia_origen != provincia_destino) %>% 
  select(provincia_origen,provincia_destino,lat_origen,lat_destino,long_origen,long_destino,viajes) %>% 
 filter(viajes > 300),aes(x = long_origen, y = lat_origen, xend = long_destino, yend = lat_destino,
                   size=viajes),
               alpha=.25,color="white",curvature = 0.3)+
  geom_point(aes(x = long,
         y = lat,size=val,color=var))+
  scale_color_manual(values = c(dnmye_colores(5),dnmye_colores(4)))+
 scale_size_area(guide = "none")+
  facet_wrap(~var,strip.position = "bottom")+
  labs(title = "Viajes por provincia de origen y destino en Previaje")+
  theme(legend.position = "none",
        strip.placement = "outside",
        strip.text = element_text(family = "Encode Sans",size = 12,vjust = 1.5))

graf_previaje_od    
```

La evoluci√≥n del gasto del cr√©dito permite ver, por otra parte, la evoluci√≥n 
del programa en toda su extensi√≥n. 

Si bien la magnitud de la segunda edici√≥n muestra la importancia de la temporada de 
verano en el gasto tur√≠stico, es posible destacar que existi√≥ una mayor participaci√≥n
de los meses de menor peso hist√≥rico en la actividad. A modo de ejemplo, los datos 
muestran que en febrero de 2022 hubo mayor gasto que en enero de ese mismo a√±o. 
Las participaciones de octubre y noviembre, de la mano de la tercera edici√≥n, 
marcan el objetivo a futuro del programa: aumentar la participaci√≥n de los meses 
de menor demanda tur√≠stica para suavizar la estacionalidad.

```{r}
credito <- read_csv("/srv/DataDNMYE/previaje/data_abierta/gasto_credito.csv")
credito_mes <- credito %>% 
  mutate(mes = paste0(year(fecha),"-",month(fecha))) %>% 
  group_by(mes) %>% 
  summarise(monto = sum(monto)) %>% 
  group_by(anio = substr(mes,1,4)) %>% 
  mutate(part = monto/sum(monto)) %>% 
  ungroup() 
credito_diario <- credito%>% 
  left_join(ipc_hyr_diario %>% select(fecha,indice_diario),by=c("fecha")) %>% 
  mutate(indice_ultimo_100 = indice_diario/last(indice_diario),
         monto_real = monto/indice_ultimo_100)
credito_mes <- credito_diario %>% 
  mutate(mes = paste0(year(fecha),"-",month(fecha))) %>% 
  group_by(mes) %>% 
  summarise(monto = sum(monto),
            monto_real = sum(monto_real)) %>% 
  group_by(anio = substr(mes,1,4)) %>% 
  mutate(part = monto/sum(monto),
         part_real = monto_real/sum(monto_real)) %>% 
  ungroup() 
gasto_edicion <- credito_diario %>% 
  mutate(edicion = case_when(fecha < "2021-11-01" ~ "previaje 1",
                             fecha >= "2021-11-01" & fecha < "2022-10-01" ~ "previaje 2",
                             fecha >= "2022-10-01" ~ "previaje 3")) %>% 
 group_by(edicion) %>% 
  summarise(monto = sum(monto),
            monto_real = sum(monto_real))
```


```{r}
credito_diario %>% 
  ggplot(aes(x=fecha,y=monto_real))+
  geom_line()+
  scale_x_date(date_labels = "%b %y")+
  scale_y_continuous(labels = scales::number_format(scale = 1/1e+6,suffix = "M"))+
  theme_minimal()+
  labs(title="Gasto del cr√©dito de Previaje",
       subtitle = "Millones de pesos de enero 2023",x="",y="")

```

# Previaje en el contexto general

Como fuera mencionado, existe un conjunto de recursos publicados en el [SINTA](https://www.yvera.tur.ar/sinta/) que permite analizar el programa Previaje
a la luz de la evoluci√≥n del turismo interno en los √∫ltimos a√±os.

```{r}
emae_serie <- read_csv("/srv/DataDNMYE/economia2/emae.csv")
```

El impacto de la pandemia fue especialmente severo en la actividad tur√≠stica: la 
actividad econ√≥mica en hoteles y restaurantes tuvo ca√≠das muy superiores al nivel general.
Asimismo, la recuperaci√≥n del sector tuvo un vigor menos marcado, en un principio por 
las limitaciones que a√∫n impon√≠a la pandemia. Es por ello que la primera edici√≥n del 
programa procur√≥ garantizar la temporada tur√≠stica de 2021. En una segunda instancia,
la recuperaci√≥n del sector estuvo liderada por el turismo interno, cuyo volumen hist√≥ricamente
elevado durante la temporada de 2022 permiti√≥ acercar los niveles de actividad a los a√±os 
previos al COVID-19. Sin embargo, el nivel global de la actividad todav√≠a no hab√≠a alcanzado,
hacia fines de 2022, los valores previos, debido a la m√°s lenta recuperaci√≥n del turismo internacional.



```{r}
emae_grafico_desest <- emae_serie %>% 
   filter(rama %in% c("nivel_general","h_hoteles_y_restaurantes")) %>% 
  group_by(rama) %>% 
  filter(fecha >= "2019-01-01" ) %>% 
  mutate(val_ene19 = 100* serie_desest/first(serie_desest)) %>% 
  ungroup() %>% 
  ggplot(aes(x=fecha,y=val_ene19,color=rama,group=rama))+
  geom_point(size=1)+
  geom_line(size=1)+
  geom_hline(yintercept = 100,color="grey")+
  scale_color_manual(values = c("h_hoteles_y_restaurantes" = dnmye_colores(2), 
                                "nivel_general" = dnmye_colores(1)),
                     labels=c("Hoteles y Restaurantes","Nivel General")) +
  scale_x_date(date_breaks = "1 month", 
               date_labels = "%b%y", 
               expand = c(0,10)) +
  #ylim(-25,5) +
  theme_minimal() +
  theme(
    text = element_text(), 
    plot.title    = element_markdown(size = 10, face = "bold"),
    plot.subtitle = element_markdown(size = 8, face = "bold"),
    plot.caption  = element_markdown(size = 8),
    #strip.text.y  = element_text(size = 4, face = "bold"),
    axis.text.x   = element_text(size = 6,angle=90),
    axis.text.y   = element_text(size = 6),
    panel.grid.minor.x = element_blank(),
    legend.position = "bottom",
    strip.placement = "outside",
    legend.title = element_blank()
  )+ 
  labs(x="",y="",title="EMAE Total y Hoteles y Restaurantes",
       subtitle="Series desestacionalizadas. √çndice ene-19 = 100",
       caption="Fuente: INDEC (desestacionalizaci√≥n propia en H y R)")
emae_grafico_desest
```

A modo de ilustraci√≥n de la importancia del turismo interno en la recuperaci√≥n reciente,
puede observarse que la actividad hotelera, medida por la [Encuesta de Ocupaci√≥n Hotelera](https://datos.yvera.gob.ar/dataset/encuesta-ocupacion-hotelera-parahotelera-eoh),
alcanz√≥ niveles r√©cord de pernoctaciones de viajeros residentes a lo largo de todos 
los meses de 2022.

<aside>

***Encuesta de Ocupaci√≥n Hotelera (EOH)***

üìä [Datos abiertos](https://datos.yvera.gob.ar/dataset/encuesta-ocupacion-hotelera-parahotelera-eoh)\
üìä [Informes](https://www.yvera.tur.ar/sinta/informe/info/encuesta-de-ocupacion-hotelera-eoh)\
üìä [Reporte](V)

</aside>

```{r}
eoh <- read_csv("http://datos.yvera.gob.ar/dataset/93db331e-6970-4d74-8589-c1223ac9c282/resource/86098160-840e-4191-a0fc-b3923bf2b0b0/download/pernoctes-residentes-y-no-residentes.csv") %>% 
  filter(origen_pernoctes == "Residentes") %>% 
  mutate(anio = as.numeric(substr(indice_tiempo,1,4)),
         mes = as.numeric(substr(indice_tiempo,6,7)))
```

```{r}
eoh_ene_nov <- eoh %>% filter(mes <= 11) %>% 
  group_by(anio) %>% 
  mutate(part_anio_pernoc = pernoctes/sum(pernoctes)) %>% 
  ungroup() %>% 
  mutate(mes = as.Date(glue("2020-{substr(indice_tiempo,6,7)}-01")))

stats_nivel <- eoh_ene_nov %>%
  filter(anio < 2020 & anio >= 2007) %>%
  group_by(mes) %>% 
  mutate(max = max(pernoctes),
         min=min(pernoctes),
         avg = mean(pernoctes))
```

```{r}
grafico_estacionalidad_nivel <- eoh_ene_nov %>% 
  filter(anio == 2022) %>% 
  ggplot(., aes(x=mes,y=pernoctes,group=as.factor(anio),color=as.factor(anio)))+
  geom_ribbon(data= stats_nivel,aes(x = mes, ymax = max, ymin = min),color="lightgrey",alpha = 0.1,fill = "grey")+
  scale_color_manual(values=c(comunicacion::dnmye_colores(5),
                              comunicacion::dnmye_colores(3)))+
  #geom_point()+
  geom_dl(aes(label = anio), method = list(dl.combine( "last.points")), cex = 0.5)+ 
   geom_line(data= stats_nivel,aes(x=mes,y=avg),color=comunicacion::dnmye_colores(1))+
  geom_point(data= stats_nivel,aes(x=mes,y=avg),color=comunicacion::dnmye_colores(1))+
  geom_line()+
  geom_point()+
   #scale_x_continuous(labels = scales::date_format(format = "%b"))+
  scale_y_continuous(labels = scales::number_format(scale=1/1e+6))+
  labs(x="",y="",title="Pernoctaciones de residentes por mes",
       subtitle = "En millones. Per√≠odo enero - noviembre",
       caption="Fuente: DNMyE en base a EOH")+
  annotate("curve", x = as.Date("2020-04-01"), xend=as.Date("2020-05-01"),yend=pull(unique(stats_nivel[stats_nivel$mes == as.Date("2020-05-01"),"max"]))*1.35,
           y =pull(unique(stats_nivel[stats_nivel$mes == as.Date("2020-04-01"),"max"]))*.95 , 
           curvature = -.3,
           color = "grey") +
  annotate(geom = "text",  
           x = as.Date("2020-05-01"),
           y = pull(unique(stats_nivel[stats_nivel$mes == as.Date("2020-05-01"),"max"]))*1.35,
           label = "Rango 2007-2019" ,
           hjust = "left", size = 3,
           color = "grey")+
  annotate("curve", x = as.Date("2020-02-01"), xend=as.Date("2020-03-01"),yend=pull(unique(stats_nivel[stats_nivel$mes == as.Date("2020-02-01"),"avg"]))*1.15,
           y =pull(unique(stats_nivel[stats_nivel$mes == as.Date("2020-02-01"),"avg"])) , 
           curvature = -.3,
           color = comunicacion::dnmye_colores(1)) +
  annotate(geom = "text",  
           x = as.Date("2020-03-01"),
           y = pull(unique(stats_nivel[stats_nivel$mes == as.Date("2020-02-01"),"avg"]))*1.15,
           label = "Promedio 2007-2019" ,
           hjust = "left", size = 3,
           color = comunicacion::dnmye_colores(1))+
  scale_x_date(date_breaks = "1 month",
               date_labels = "%b",
               expand = c(0,20)
               )+
  theme_minimal()+
  coord_cartesian(clip = "off")+
  theme(legend.position = "none",
        plot.subtitle  = element_markdown(),
        axis.text.x   = element_text(size = 8),
        axis.text.y   = element_text(size = 8),
        text = element_text(family = "Encode Sans"),
        panel.grid.minor = element_blank()
  )
grafico_estacionalidad_nivel
```

Otro aspecto mencionado anteriormente es la marcada estacionalidad de la actividad tur√≠stica: algunos meses del a√±o (t√≠picamente los primeros meses del a√±o y julio) concentran una porci√≥n significativa 
de la actividad, lo que redunda en la inestabilidad del empleo y los ingresos de quienes trabajan en el sector.
En este sentido, se observ√≥ durante 2022 una leve ca√≠da en la participaci√≥n de enero y m√°s 
notoriamente del mes de julio (en un contexto de crecimiento de esos meses respecto de los niveles previos a la pandemia). A su vez, febrero y abril mejoraron sustancialmente su peso en el total.
Como puede observarse, persiste a√∫n una elevada disparidad entre la participaci√≥n de cada mes. En particular, los meses de mayo y junio son los de menor nivel de pernoctaciones. Es por ello que las pr√≥ximas ediciones de Previaje apuntar√°n a equilibrar estas asimetr√≠as que, al interior de algunos destinos, pueden ser a√∫n m√°s importantes.[^doc_estacionalidad]

[^doc_estacionalidad]: Para una descripci√≥n m√°s detallada de la estacionalidad en el turismo en Argentina puede consultarse el Documento de Trabajo N¬∞6 de la DNMyE, [_Estacionalidad en el Turismo_](https://tableros.yvera.tur.ar/recursos/biblioteca/estacionalidad_turismo.pdf) publicado en biblioteca.yvera.tur.ar

```{r}
stats <- eoh_ene_nov %>%
  filter(anio < 2020 & anio >= 2015) %>%
  group_by(mes) %>% 
  mutate(max = max(part_anio_pernoc),
         min=min(part_anio_pernoc),
         avg = mean(part_anio_pernoc))
grafico_estacionalidad <- eoh_ene_nov %>% 
  filter(anio == 2022) %>% 
  ggplot(., aes(x=mes,y=part_anio_pernoc,group=as.factor(anio),color=as.factor(anio)))+
  geom_ribbon(data= stats,aes(x = mes, ymax = max, ymin = min),color="lightgrey",alpha = 0.1,fill = "grey")+
  geom_line()+
  geom_point()+
  scale_color_manual(values=c(comunicacion::dnmye_colores(5),
                              comunicacion::dnmye_colores(3)))+
  #geom_point()+
  geom_line(data= stats,aes(x=mes,y=avg),color=comunicacion::dnmye_colores(1))+
  geom_point(data= stats,aes(x=mes,y=avg),color=comunicacion::dnmye_colores(1))+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
  geom_dl(aes(label = anio), method = list(dl.combine( "last.points")), cex = 0.8)+ 
   #scale_x_continuous(labels = scales::date_format(format = "%b"))+
  labs(x="",y="",title="Participaci√≥n por mes de las pernoctaciones de residentes hospedados",
       subtitle = "Per√≠odo enero - noviembre",
       caption="Fuente: DNMyE en base a EOH")+
  annotate("curve", x = as.Date("2020-04-01"), xend=as.Date("2020-05-01"),yend=pull(unique(stats[stats$mes == as.Date("2020-05-01"),"max"]))*1.35,
           y =pull(unique(stats[stats$mes == as.Date("2020-04-01"),"max"]))*.95 , 
           curvature = -.3,
           color = "grey") +
  annotate(geom = "text",  
           x = as.Date("2020-05-01"),
           y = pull(unique(stats[stats$mes == as.Date("2020-05-01"),"max"]))*1.35,
           label = "Rango 2015-2019" ,
           hjust = "left", size = 3,
           color = "grey")+
  annotate("curve", x = as.Date("2020-02-01"), xend=as.Date("2020-03-01"),yend=pull(unique(stats[stats$mes == as.Date("2020-02-01"),"avg"]))*1.15,
           y =pull(unique(stats[stats$mes == as.Date("2020-02-01"),"avg"])) , 
           curvature = -.3,
           color = comunicacion::dnmye_colores(1)) +
  annotate(geom = "text",  
           x = as.Date("2020-03-01"),
           y = pull(unique(stats[stats$mes == as.Date("2020-02-01"),"avg"]))*1.15,
           label = "Promedio 2015-2019" ,
           hjust = "left", size = 3,
           color = comunicacion::dnmye_colores(1))+
  scale_x_date(date_breaks = "1 month",
               date_labels = "%b",
               expand = c(0,20)
               )+
  theme_minimal()+
  coord_cartesian(clip = "off")+
  theme(legend.position = "none",
        plot.subtitle  = element_markdown(),
        axis.text.x   = element_text(size = 8),
        axis.text.y   = element_text(size = 8),
        text = element_text(family = "Encode Sans"),
        panel.grid.minor = element_blank()
  )
grafico_estacionalidad
```

# Recursos disponibles

Los datos abiertos de Previaje forman parte de un conjunto de recursos de [turismo interno](https://datos.yvera.gob.ar/dataset?groups=turismo-interno) publicados en [datos.yvera.gob.ar](datos.yvera.gob.ar), que incluye turismo social, la Encuesta de Viajes y Turismo de los Hogares y los datos que provienen del Certificado √önico Habilitante para Circulaci√≥n (CUHC) - Verano. 

üîó [Sistema de Informaci√≥n Tur√≠stica de Argentina (SINTA)](https://www.yvera.tur.ar/sinta/)


::: {.infobox}
Para recibir las novedades del SINTA escrib√≠le al bot de Telegram de la DNMyE <a href=‚Äòhttps://bitacora.yvera.tur.ar/posts/2022-09-08-sintia/‚Äô target=‚Äò_blank‚Äô>*SintIA*</a>: <a href=‚Äòhttps://t.me/RDatinaBot‚Äô target=‚Äò_blank‚Äô>@RDatinaBot</a> ü§ñ
:::
